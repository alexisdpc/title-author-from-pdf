Energy 265 (2023) 126147
Available online 21 November 2022
0360-5442/© 2022 The Authors. Published by Elsevier Ltd. This is an open access article under the CC BY-NC license (http://creativecommons.org/licenses/by-
nc/4.0/).
Contents lists available at ScienceDirect
Energy
journal homepage: www.elsevier.com/locate/energy
Optimal scheduling of ancillary services provided by an electric vehicle
aggregator
S. de la Torre a,∗, J.A. Aguado a, E. Sauma b
a Escuela de Ingenierías Industriales, Universidad de Málaga, Spain
b Millennium Institute on Green Ammonia as Energy Vector (MIGA), Engineering School, Pontificia Universidad Católica de Chile, Chile
A R T I C L E
I N F O
Keywords:
Aggregator
Electric vehicles
Vehicle-to-grid
Ancillary services
Regulation
Mixed-integer linear programming problem
A B S T R A C T
Massification of Electric vehicles (EVs) is becoming a worldwide reality as a means to combat climate
change and local pollution. Considering that most of the time vehicles are in parking places, there is an
opportunity for using EVs to provide some valuable services to the power network. In particular, EVs can
provide ancillary services in electricity markets through an aggregating agent. To this end, EVs aggregators
need to develop decision support tools to optimally allocate energy and regulation resources considering power
network constraints. Unlike optimization models for EVs aggregators currently available in the literature,
in this paper we propose an optimization approach for EVs aggregators that jointly considers the most
important aspects influencing EVs profitability, such as uncertainty, drivers’ patterns, capacity constraints,
state of charge constraints, regulation demand constraints, regulation offer constraints, regulation bounds
constraints, and power-system security constraints. The optimization problem is formulated as a mixed-
integer linear programming problem, thus ensuring global optimality. Results are presented in the form of
the hourly allocation for charging/discharging power profiles, distinguishing between day-ahead energy and
capacity/energy for regulation, and the profit that can be reached, while accounting for network constraints.
The proposed model is illustrated through a case study, which allows us to show that EVs aggregators
allow for leading to a more reliable power system operation, avoiding transmission lines congestion, while
providing important profits for EV owners who are able to provide regulation services.
1. Introduction
The transportation sector is responsible for more than one fourth
of the total greenhouse gas (GHG) emissions worldwide [1]. This fact
has motivated the massification of Electric Vehicles (EVs) to combat
climate change and local pollution, which entails significant power
system investments to support the needed charging infrastructure [1].
However, for most cases, the majority of the time these vehicles are
located in parking places. Accordingly, there is an opportunity for
using EVs to provide some valuable services to the power network.
In particular, with the large penetration of variable renewable energy
(mainly wind and solar) present in current power systems, there is a
growing need for power flexibility in grids, which can be provided by
batteries in EVs. However, to have the significant amount of power
flexibility that the power system needs, it is necessary to aggregate
many EV batteries. Thus, EVs can provide these flexibility or ancillary
services in electricity markets through an aggregating agent.
Roughly speaking, aggregators schedule EV charging at the lowest
possible cost while guaranteeing the minimum energy requirement
∗ Corresponding author.
E-mail address: storre@uma.es (S. de la Torre).
profiles; that is, they have to guarantee that EVs users have enough
energy in their batteries to perform their daily journeys. They also have
to comply with technical constraints imposed by the system operator,
avoiding, whenever possible, line congestion or undesirable voltage
level variations. In addition, they can use EVs as energy backup devices,
supplying energy to the grid, taking advantage of Vehicle-to-Grid (V2G)
technology. In this sense, EVs can obtain additional revenue and can
help the electric power system by supporting the integration of renew-
able energy sources or by providing peak power, frequency regulation
and/or spinning reserve [2–13]. All of these ancillary services and
other additional services are covered in this work under the general
terms ‘‘regulation’’ or ‘‘secondary regulation’’; distinguishing between
the availability to provide a certain service (capacity) and the actual
realization of the service (effective energy).
Unidirectional regulation, that is, the provision of regulation ser-
vices making use of only EV charging capability is studied in [14]. The
authors develop a deterministic optimization model aiming at maximiz-
ing aggregator profit including the concept of preferred operation point
https://doi.org/10.1016/j.energy.2022.126147
Received 2 November 2021; Received in revised form 15 November 2022; Accepted 18 November 2022
Energy 265 (2023) 126147
2
S. de la Torre et al.
Acronyms
Electric Vehicle (EV), State of Charge (SOC), Vehicle-to-Grid
(V2G).
Notation
Sets
𝛹���𝑎���𝑎���
Set
of
all
scenarios
considered
to
ac-
count for EVs charging/discharging time
uncertainty (EV group scenarios).
𝛹���𝑎���𝑖���
Set of all scenarios designed to account
for the uncertainty in the prices of en-
ergy, regulation capacity, and effective
regulation.
𝛹���𝑖���
Set of nodes in the network.
𝛹���𝑖���
Set of all periods in the time horizon under
study.
𝛹���𝑖���
Set of all EV groups considered.
Indices
𝑎���𝑎���
EV group scenarios.
𝑎���𝑖���
Energy price and regulation capacity sce-
narios.
𝑖���, 𝑖���
Grid nodes.
𝑖���
Time periods.
𝑖���
EV groups.
Parameters
𝐴𝐴���𝑎���𝑎���
𝑖���
Aggregated value of the EV battery ca-
pacities
for
group
𝑖���
and
scenario
𝑎���𝑎���
[MWh].
𝐴���𝑖���,𝑖���
Susceptance of line 𝑖��� − 𝑖��� [S].
𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖���
SOC requirement for EV group 𝑖���, scenario
𝑎���𝑎��� and time period 𝑖��� [MWh].
𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖���
Aggregated consumption for EV group 𝑖���,
scenario 𝑎���𝑎��� and time period 𝑖��� in journeys
[MWh].
𝐴���𝑎���𝑎���
𝑖���,𝑖���,𝑖���
Binary values parameter that equals 1
when EV group 𝑖��� is connected for scenario
𝑎���𝑎���, time period 𝑖��� and node 𝑖��� and zero in
other case.
𝐴���𝑎���, 𝐴���𝑖���, 𝐴���𝑎���, 𝐴���𝑎���, 𝐴���𝑖���
Large enough scalars used in several ‘‘Big
M’’ equations through the formulation; in
general, these values will be different.
𝐴��� 𝑖���,𝑖���
𝑖���𝑎𝑖���
Power flow limit for the line that connects
nodes 𝑖��� and 𝑖��� [MW].
𝐴��� 𝐴���
𝑖���,𝑖���, 𝐴��� 𝐴���
𝑖���,𝑖���
Hourly generated power/load in system
nodes [MW].
𝐴���
𝑎���𝑎���
𝑖��� , 𝐴��� 𝑎���𝑎���
𝑖���
Upper limit for charging/discharging de-
fined for EV group 𝑖��� and scenario 𝑎���𝑎���
[MW].
𝐴���𝐴���𝑎���𝑎���
𝑖���
Minimum SOC for group 𝑖��� and group
scenario 𝑎���𝑎��� [MWh].
𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
, 𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
Energy price for charging/discharging for
scenario 𝑎���𝑖��� and time period 𝑖��� [e/MWh].
𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
, 𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
Price at which the availability for down-
ward/upward regulation is paid for sce-
nario 𝑎���𝑖��� and time period 𝑖��� [e/MWh].
and also determining it through optimization and heuristics models
and comparing the different approaches. The same authors extend their
model [15] considering spinning reserve and unplanned EV departures.
𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
, 𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
Price
at
which
the
effective
downward/upward
regulation
is
paid
for scenario 𝑎���𝑖��� and time period 𝑖��� [e/MWh].
𝜁���𝐴���, 𝜁���𝐴���
EV charging/discharging efficiency.
𝜒���𝑎���𝑎���
Probability associated to scenario 𝑎���𝑎��� in 𝛹���𝑎���𝑎���.
𝜒���𝑎���𝑖���
Probability associated to scenario 𝑎���𝑖��� in 𝛹���𝑎���𝑖���.
Variables
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� , 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� , 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
Auxiliary
variables
for
down-
ward/upward/effective
regulation
availability/charging and discharging.
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� , 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
Energy withdrawn/supplied by the EVs
from/to the grid for EV group 𝑖���, time period
𝑖���, in node 𝑖���, and scenarios 𝑎���𝑎��� and 𝑎���𝑖��� [MWh].
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� , 𝐴���𝐴��� 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
Downward/upward maximum regu-
lation availability for EV group 𝑖���, time
period 𝑖��� and scenarios 𝑎���𝑎��� and 𝑎���𝑖��� [MW].
𝐴���𝐴���𝑖���, 𝐴���𝐴���𝑖���
Downward/upward regulation EV aggre-
gator capacity offered at time period 𝑖���
[MW].
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� , 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
Energy from effective downward/upward
regulation for group 𝑖���, time period 𝑖���, node
𝑖��� and scenarios 𝑎���𝑎��� and 𝑎���𝑖��� [MWh].
𝐴���𝐴���𝐴���
Profit obtained in the Energy market [ e]
𝐴���𝐴���𝐴���
Profit obtained in the Effective Regulation
market [e].
𝐴���𝐴���𝐴���
Profit obtained in the Regulation capacity
market [e].
𝐴��� 𝐴���𝐴���
𝑖���,𝑖���
EV power contribution at node 𝑖��� and time
period 𝑖��� [MW].
𝐴��� 𝑖���,𝑖���
𝑖���
Hourly power flow in line 𝑖��� − 𝑖��� [MW].
𝐴��� 𝐴���
𝑖���
Hourly power injected in the slack bus
[MW].
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
EVs aggregated SOC for EV group 𝑖���, time
period 𝑖��� and scenarios 𝑎���𝑎��� and 𝑎���𝑖��� [MWh].
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
, 𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
EVs aggregated SOC limit for EV
group 𝑖���, time period 𝑖��� and scenarios 𝑎���𝑎���
and 𝑎���𝑖��� for downward/upward regulation
[MWh].
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
EVs aggregated SOC for EV group 𝑖���, time
period 𝑖��� and scenarios 𝑎���𝑎��� and 𝑎���𝑖��� for effective
regulation [MWh].
𝜁���𝑖���
𝑖���
Phase of the node voltage 𝑖��� at time period 𝑖���
[rad].
Binary Variables
𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,1, 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,2
Binary variables for effective regulation
charging and discharging and daily market.
𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,3, 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,4, 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,5
Binary variables for timely evolution equa-
tions of the SOC.
Positive variables
The following variables may only take values equal to or
greater than zero.
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
, 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
Auxiliary positive variables for downward
regulation availability.
In [16], an optimal strategy for EV aggregators is developed, but only
controlling the EV charging scheme to provide regulation. In [17], a
linear programming model is proposed in order to maximize the EV
Energy 265 (2023) 126147
3
S. de la Torre et al.
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
, 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
Auxiliary positive variables for effective
regulation charging and discharging.
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
, 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
Auxiliary
positive
variables
for
upward
regulation availability.
aggregator revenues obtained from the provision of regulation services,
subject to the constraint of achieving a target EV State of Charge (SOC),
controlling only the charging sequence. None of these works, however,
consider the impacts of network constraints.
A co-optimization approach is presented in [18], which considers,
on the one hand, an optimal power flow that avoids line congestion
and schedules EV charging giving enough flexibility for regulation and,
on the other hand, a decentralized real-time dispatch of the automatic
generation control signal. It is proved that an optimal EV SOC can be
established to comply with a contracted capacity regulation and that it
is possible to achieve high response accuracy to the regulation signal.
In [19], the authors determine optimum aggregation areas for a given
network configuration that can be used for EV aggregators and system
operators to take decisions regarding regulation and line congestion
issues. The model features a low computation effort and it is proved in
base and future case scenarios illustrating some effectiveness in terms
of voltage and load loss control. Although these approaches model
network constraints, they do not consider uncertainties.
In [20], a model based on stochastic optimization of EV charg-
ing and frequency regulation is proposed considering the uncertainty
associated to the hourly energy and regulation prices as well as the
regulation signal. Results are compared against deterministic model
predictive problems giving a reduction in EV charging costs. Several
works have also been presented taking into account the participation
of the EV aggregators in electricity markets. In [21], generation, EV
charging, reserve and regulation are considered. A market clearing pro-
cedure without security constraints is proposed along with a real-time
operation to deploy reserves with renewable generation forecasting. A
day-ahead optimization model is proposed to determine energy and
secondary reserves bids minimizing total costs in [22] considering pay-
ments for both capacity and energy from regulation. Other strategies
considering bidding EV regulation through optimization have been
proposed in [10,11,23,24]. In [12], a two-level optimization algorithm
for EVs is proposed to determine optimal operation strategies of EV
aggregators and the charging power of each individual EV considering
the participation in ancillary service markets. The authors in [13]
propose a control strategy to operate at fast time-steps which allows
EV aggregators maximize capacity payments from ancillary service
markets. In [25], the authors highlight that the size of the EV fleet
is also a key factor to assess the profitability of V2G schemes. This is
because large fleets of EVs are generally needed to significantly impact
the electricity demand curve. Drivers’ consumption patterns are not
considered in any of those works.
As a summary of the literature review, it is worth mentioning
that (i) only the authors in [18] consider the characteristics of the
grid and the possibility of line congestion, (ii) only in [22] the effec-
tive charging from regulation, including their economic terms in the
objective function, is taken into account in contrast to other works
like [14,15,21,23,24], (iii) bidirectional regulation (that is, the energy
injection from EVs to the grid) is not included in [16,20,22,26], and (iv)
none of the cited works jointly consider uncertainty in prices, power
system operation impacts, and driving patterns.
In this paper, we propose a detailed model for the problem faced
by EV aggregators to assess their participation in electricity markets
for regulation services, while jointly considering the most important
aspects influencing EVs profitability, such as uncertainty, drivers’ pat-
terns, capacity constraints, state of charge constraints, regulation de-
mand constraints, regulation offer constraints, regulation bounds con-
straints, and power system security constraints. To the best of our
knowledge, such a comprehensive model has not been addressed in any
similar way in the literature.
Our model presents the following features:
• The aggregator manages a fleet of EVs.
• The aggregator participates in energy markets in order to buy the
energy that the EVs need to satisfy their mobility constraints.
• The aggregator may also participate in energy markets in order
to sell excess energy, using V2G capabilities.
• The aggregator participates in a secondary regulation market,
wherein it receives payments for both capacity offered and effec-
tive charging and discharging performed.
• The electric power system is modelled in detail, implementing
the power flow equations (a DC-power flow model is used, im-
plementing Kirchhoff’s Laws), among other technical constraints.
• The uncertainty associated with day-ahead energy prices is con-
sidered via scenarios.
The proposed model is a mixed-integer linear program aiming at
maximizing EV aggregator benefit. It allows an EV aggregator to know
which are the most suitable time periods to perform regulation and pur-
chase/sell energy from the daily market. In addition, the EV aggregator
can foresee which nodes can be problematic from the point of view of
system reliability, helping the system operator.
Accordingly, the EV aggregator problem is solved jointly consider-
ing the energy market for EV charging/discharging and the regulation
market for energy and capacity, in contrast to other approaches that
consider either only one of them or both separately. In this sense, it
is possible to reach an optimal result that avoids forcing batteries to
reach their energy limits. However, this approach requires to predict at
the first step all the parameters that include uncertainty, losing some
accuracy due to the further time gap for the estimation.
On the other hand, none of the works mentioned in the literature re-
view consider battery ageing effects. This is one of the major challenges
to be overcome with respect to the regulation provision, specially when
V2G effective discharging is used. Despite the economical barriers re-
lated to this issue, it has not been solved yet. The scientific community
and practitioners agree that the discharging process significantly affects
battery life and performance [27–31]. Although a comprehensive anal-
ysis related to battery use is out of the scope of this work, some results
are provided to estimate this effect, once the solution is obtained. Our
study shows that, as pointed out by some authors [32], it is imperative
to overcome the issues related to the battery degradation when full
charge/discharge cycles take place.
The main contributions of this paper can be summarized as follows:
• Development of a comprehensive tool, based on stochastic opti-
mization, that may be used by an EV aggregator to jointly sched-
ule energy and capacity/energy for regulation markets taking into
account the most relevant power system constraints.
• Development of a tool that also allows EV aggregators to assess
their participation in electricity markets through the determina-
tion of the most suitable time periods to bid and the prediction
of the nodes that can lead to line congestion.
• Development of a simple scenario-based methodology that si-
multaneously includes the uncertainty associated to energy and
regulation prices and driving patterns.
The rest of the paper is organized as follows. Section 2 describes the
scenario-based approach employed to model the uncertainty associated
to both energy and regulation prices and EV driving patterns and
the full optimization model. An illustrative case study is presented in
Section 3, whose results are discussed in Section 4. Finally, Section 5
concludes the paper.
Energy 265 (2023) 126147
4
S. de la Torre et al.
2. Optimization problem formulation
In this section, an optimization problem is formulated in order
to properly model the rational behaviour of an EV aggregator com-
pany facing different markets and operating within an stochastic en-
vironment. This optimization problem comprises a detailed objective
function and a set of constraints.
2.1. Uncertainty modelling
To model the uncertainty associated to EV driving patterns and mar-
ket prices, a simple scenario-based approach is considered on this work.
A set of different scenarios, 𝛹���𝑎���𝑖���, is selected to account for the
stochasticity in the price vector. The prices considered are: buy/sell
energy, up/down regulation capacity and up/down effective regulation.
More specifically, for the purpose of this work, hourly price curves
for EV charging and discharging have been used. Prices for capacity
regulation have been similarly assumed, although capacity prices for
upward and downward regulation have been chosen to be equal, (this
condition could easily be relaxed); effective energy regulation prices
for up and down regulation are different and also depend on the time
of the day.
In this work, vehicles that have similar behaviour are grouped
together, hence avoiding the burden of modelling individual EVs; for
each case we consider, we have several groups of vehicles that we can
track. Naturally, another set of scenarios, 𝛹���𝑎���𝑎���, is taken into account
for the different possible configurations of the EV groups. The EVs
considered in this work are all identical, with a battery capacity of
20 kWh and a maximum power for charging/discharging of 3.7 kW.
The scenarios used for EV groups take into account the facts that the
number of cars in a group may change and also that the paths taken
by the vehicles during the day may change, as a consequence, the
total energy needs of a group of vehicles are different from scenario
to scenario. More details on the selections of scenarios are presented in
the case study section of the paper. Note that, for realistic case studies,
this information may be obtained from mobility surveys that some
authorities carry out, and that include a range of different questions to
the users of roads and transportation facilities in general; the questions
asked may include origin and destination of their trips, routes selected,
time allotted, etc.
The scenarios in 𝛹���𝑎���𝑖��� are chosen to be equiprobable. Analogously,
the scenarios in 𝛹���𝑎���𝑎��� are considered equiprobable.
2.2. Objective function
The objective function maximizes the profit earned by the EV
aggregator as a result of its participation in all three above men-
tioned market mechanisms (energy exchange, regulation capacity and
effective regulation). The total profit maximization can be formulated
as:
maximize {𝐴���𝐴���𝐴��� + 𝐴���𝐴���𝐴��� + 𝐴���𝐴���𝐴���}
(1)
𝐴���𝐴���𝐴��� =
∑
(𝑖���,𝑖���,𝑖���)
∑
(𝑎���𝑎���,𝑎���𝑖���)
𝜒���𝑎���𝑎��� ⋅ 𝜒���𝑎���𝑖��� ⋅ (𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
⋅ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − 𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
⋅ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� )
(2)
𝐴���𝐴���𝐴��� =
∑
𝑖���
∑
𝑎���𝑖���
𝜒���𝑎���𝑖��� ⋅ (𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
⋅ 𝐴���𝐴���𝑖��� + 𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
⋅ 𝐴���𝐴���𝑖���)
(3)
𝐴���𝐴���𝐴��� =
∑
(𝑖���,𝑖���,𝑖���)
∑
(𝑎���𝑎���,𝑎���𝑖���)
𝜒���𝑎���𝑎��� ⋅ 𝜒���𝑎���𝑖��� ⋅ (𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
⋅ 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� + 𝜁���𝐴���𝐴���−𝐴���
𝑖���,𝑎���𝑖���
⋅ 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� )
(4)
The objective function presented in (1), comprises three terms,
described below:
• In (2), 𝐴���𝐴���𝐴��� represents the profit obtained from energy exchanges,
computed as the difference between the income from EV discharg-
ing (V2G) and the costs of EV charging. Note that this is computed
taking into account the different prices for the energy exchange;
in general, these prices are different for each hour and scenario.
Also note that this term may be a positive or a negative amount.
𝐴���𝐴��� and 𝐴���𝐴��� refer to the traded energy in the hourly spot market.
• In (3), 𝐴���𝐴���𝐴��� computes the income obtained from EV regulation
capacity. The prices offered for both UP and DOWN regulation
capacity are included. It is important to highlight that the offers
in this market are made for a total amount of energy for each
time period, but no specific node or specific vehicle group is
declared when presenting the offer. Moreover, the offers are made
before having information on which price and EV scenarios will
end up taking place, so the offers must be valid for any price or
vehicle scenarios (note that variables 𝐴���𝐴���𝑖��� and 𝐴���𝐴���𝑖��� only have one
subindex). This term can only be a positive amount.
• In (4), 𝐴���𝐴���𝐴��� is the income related to effective energy charging/
discharging, resulting from the participation in the regulation
system. Note that, though the offers to the regulation capacity
market discussed in the previous point are aggregated, the effec-
tive energy generated or consumed for regulation purposes has
to be computed for each node, EV group and scenario. This term
can only be a positive amount. 𝐴���𝐴���𝐴��� and 𝐴���𝐴���𝐴��� refer to the traded
energy in the secondary regulation market.
In the equations above, each term is obtained by multiplying the
specific price by the corresponding energy or power variable related to
charging, discharging or capacity and multiplied also by the weight of
the considered scenarios. Also, note that the 6 main variables in the
formulation are the ones included in (2)–(4). It is important to notice
that the variables in Eqs. (2) and (4) may take a different value for
each scenario, whereas the variables in (3) take a single value for each
hour; the explanation is that the variables in (3) are offers made to a
regulation capacity market and have to be the same regardless of the
scenario finally taking place. On the other hand, the rest of the main
variables represent that the decisions can adapt to the specific scenario
that takes place.
The EV aggregator regulation optimization problem formulation is
completed with the constraints introduced in the following subsections.
2.3. State of charge constraints
Firstly, it is important to remark that, in the present formulation,
EVs are never considered individually; all the EVs that form an EV
group are aggregated together, and all its energy and power exchanges
are considered in an aggregated manner. For each aggregated battery
in each scenario, its 𝐴���𝐴���𝐴��� must be computed for each hour: 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
.
The following upper and lower limits must be imposed on the value of
𝐴���𝐴���𝐴��� variables.
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≤ 𝐴𝐴���𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(5)
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≥ 𝐴���𝐴���𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(6)
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≥ 𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(7)
Eqs. (5)–(7) guarantee that SOC lies between its lower and its upper
bounds. These bounds are imposed by the battery capacity (𝐴𝐴���), (5);
the technical operational minimum SOC for the batteries (𝐴���𝐴���), (6) and
the energy requirements of the users (𝐴���𝐴���), (6). Note that the third of
these terms may be different for each hour, reflecting the needs of the
users.
The hourly tracking of the 𝐴���𝐴���𝐴��� takes into account the charging and
discharging actions, including their efficiencies and the battery energy
consumption in journeys. It is expressed as follows:
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
= 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���−1 + 𝜁���𝐴��� ⋅
∑
𝑖���
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − (1∕𝜁���𝐴���) ⋅
∑
𝑖���
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − 𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖��� (8)
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
Note that a full set of constraints is imposed for each scenario.
Energy 265 (2023) 126147
5
S. de la Torre et al.
2.4. Effective regulation constraints
Note that in Eq. (8) only the variables related to the energy market
are used (charging and discharging). However, in practice, effective
regulation must also be considered; hence an additional set of con-
straints and variables need to be imposed. Note that the first set of
constraints is kept for consistency, as the regulation markets are still
uncertain in a real market at the moment of deciding the charging and
discharging profile for the day.
Additional variables and constraints needed to implement this
model are presented next. Firstly, the actual total energy exchange
made by each battery at each node at each time period and for each
scenario, 𝐴���𝐴���𝑖���,𝑖���,𝑖���, is defined as:
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� = 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� +𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� −𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� −𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖��� (9)
Variable 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� computes the net energy exchange seen from the
battery, considering both the charging (𝐴���𝐴���) and discharging (𝐴���𝐴���)
operations and the effective regulation exchange, either up (𝐴���𝐴���𝐴���) or
down (𝐴���𝐴���𝐴���). Note that this value may be either positive or negative.
In our formulation, in order to be able to correctly consider the effi-
ciency of the charging and discharging process, this variable must be
decomposed into two positive terms as follows1:
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� = 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
− 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(10)
As previously mentioned, a new set of constraints must be now
imposed regarding the energy exchange variables once effective reg-
ulation is included, to that end, a new variable, 𝐴���𝐴���𝐴���𝐴���𝐴���, is defined.
This variable plays the same role as 𝐴���𝐴���𝐴��� but including the effective
regulation results.
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
= 𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���−1 + 𝜁���𝐴��� ⋅
∑
𝑖���
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
− (1∕𝜁���𝐴���) ⋅
∑
𝑖���
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
− 𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖���
(11)
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
Note that new limit constraints have to be imposed:
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≤ 𝐴𝐴���𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(12)
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≥ 𝐴���𝐴���𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(13)
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≥ 𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(14)
2.5. Regulation offers constraints
In a similar fashion, we need to be sure that all the offers presented
to the regulation market are feasible and coherent with the schedule
proposed for the charging and discharging of the vehicles. However,
at the moment of submitting the bids to the regulation markets it
is uncertain which ones will be accepted and which ones will not
be accepted. Ideally, one would like to have a means of checking
all the possible combinations of accepted/not accepted offers to con-
firm that all combinations result in feasible battery behaviour; this
is impossible in our model, as our regulation offers are aggregated
through the network and are the same for all the scenarios; but, even
if it were possible, the computational burden would be huge, given
the combinatorial nature of the problem. So, as an approximation, in
our model, we impose constraints related to two opposing worst-case
1 Note that this separation of variables was not needed in Eq. (8), as both
CE and DE can never be different from zero at the same time; however, given
that we have four terms in (9) it may be possible to have simultaneous values
different from zero; for example in CE and URE, and hence, if one were
to introduce this terms separately in the 𝐴���𝐴���𝐴���𝐴���𝐴��� equation, the amount of
‘‘efficiency losses’’ incurred would be greater than the real values, due to not
considering the cancellation effect derived from the real net energy exchange.
scenario situations, the first one is that we want to make sure that the
𝐴���𝐴���𝐴��� of the battery is feasible even if only the downward effective
regulation variables take effect; the second situation considers that
only the upward effective regulation takes place. Note that we use the
values of the effective regulation results as a means of checking whether
the offers to the regulation market are consistent with the rest of the
problem.
Hence, in order to impose limits on the offers to the regulation
markets, we must define two new variables:
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� = 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� + 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(15)
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� = 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(16)
Note that this new variables represent, respectively, the energy
exchange seen from the battery if all down/up regulation operations
are effectively performed, and no up/down regulation takes place.
In our formulation, these variables must also be decomposed into
two positive terms as follows:
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� = 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
− 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(17)
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� = 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
− 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(18)
Using these new variables, new constraints similar to (11) need to
be imposed on the auxiliary variables 𝐴���𝐴���𝐴���𝐴���𝐴��� and 𝐴���𝐴���𝐴���𝐴���𝐴���.
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
= 𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���−1 + 𝜁���𝐴��� ⋅
∑
𝑖���
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
− (1∕𝜁���𝐴���) ⋅
∑
𝑖���
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
− 𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖���
(19)
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
= 𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���−1 + 𝜁���𝐴��� ⋅
∑
𝑖���
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
− (1∕𝜁���𝐴���) ⋅
∑
𝑖���
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
− 𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖���
(20)
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
In this manner, we can assure that the battery state of charge is
always within acceptable limits, even without knowing in advance
which regulation offers will be accepted. Also, note that, again, new
limit constraints have to be imposed:
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≤ 𝐴𝐴���𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(21)
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≥ 𝐴���𝐴���𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(22)
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≥ 𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(23)
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≤ 𝐴𝐴���𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(24)
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≥ 𝐴���𝐴���𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(25)
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���
≥ 𝐴���𝐴���𝑎���𝑎���
𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(26)
2.6. Integrality constraints
Several constraints relating to integer variables must be imposed
in the model. Simultaneous charging and discharging during the same
time period, for every EV group, node or scenario, both for energy and
regulation is not allowed. These constraints are considered through the
corresponding binary variables in Eqs. (27)–(28):
0 ≤ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,1 ⋅ 𝐴���𝑎��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(27)
0 ≤ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ (1 − 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,1) ⋅ 𝐴���𝑎��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(28)
Analogous equations must also be stated for the effective regulation
energy exchange variables 𝐴���𝐴���𝐴��� and 𝐴���𝐴���𝐴���, which must not be different
from zero at the same time:
0 ≤ 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,2 ⋅ 𝐴���𝑖��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(29)
0 ≤ 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ (1 − 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,2) ⋅ 𝐴���𝑖��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(30)
Energy 265 (2023) 126147
6
S. de la Torre et al.
Additionally, note that more equations analogous to (27)–(28) must
be imposed on 𝐴���𝐴���±:
0 ≤ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
≤ 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,3 ⋅ 𝐴���𝑎��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(31)
0 ≤ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
≤ (1 − 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,3) ⋅ 𝐴���𝑎��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(32)
Lastly, two more sets of similar equations must be imposed for
auxiliary variables 𝐴���𝐴���+ and 𝐴���𝐴���−, 𝐴���𝐴���+ and 𝐴���𝐴���−, introduced above.
0 ≤ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
≤ 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,4 ⋅ 𝐴���𝑎��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(33)
0 ≤ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
≤ (1 − 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,4) ⋅ 𝐴���𝑎��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(34)
0 ≤ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,+
𝑖���,𝑖���,𝑖���
≤ 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,5 ⋅ 𝐴���𝑖��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(35)
0 ≤ 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���,−
𝑖���,𝑖���,𝑖���
≤ (1 − 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,5) ⋅ 𝐴���𝑖��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(36)
Note that each of these pairs have their corresponding binary vari-
ables 𝜚𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���,∗ as shown in the notation section.
2.7. Regulation bounds
The capacity that is available for regulation is determined with
Eqs. (37)–(40), below.
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ 𝐴���𝑎���𝑎���
𝑖���,𝑖���,𝑖��� ⋅ 𝐴���
𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(37)
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ 𝐴���𝑎���𝑎���
𝑖���,𝑖���,𝑖��� ⋅ 𝐴��� 𝑎���𝑎���
𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(38)
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� + 𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� = 𝐴���𝑎���𝑎���
𝑖���,𝑖���,𝑖��� ⋅ 𝐴���
𝑎���𝑎���
𝑖���
(39)
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� + 𝐴���𝐴��� 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� = 𝐴���𝑎���𝑎���
𝑖���,𝑖���,𝑖��� ⋅ 𝐴��� 𝑎���𝑎���
𝑖���
(40)
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
Using these equations the values of the maximum available margin
for up/down regulation, 𝐴���𝐴���𝐴���𝐴���𝐴��� and 𝐴���𝐴���𝐴���𝐴���𝐴���, are fixed.
Eqs. (37) and (38) state the limits for charging (𝐴���𝐴���) and discharging
(𝐴���𝐴���) depend on the EV availability 𝐴���, and the maximum power of
the connection point to the grid, 𝐴��� and 𝐴��� . Similarly, Eqs. (39) and
(40) compute the upward and downward regulation capacities, as the
difference between the real exchange and the respective limits of the
exchange.
2.8. Regulation capacity offered
Note that the 𝐴���𝐴��� 𝐴���𝐴���𝐴��� and 𝐴���𝐴���𝐴���𝐴���𝐴��� variables are computed for
each vehicle group, for each hour, for each node, for each scenario.
However, in our model, offers presented to the regulation capacity
market must be aggregated in the form of hourly bids; these bids cover
all the network and must be applicable for any scenario that may
take place. The values of 𝐴���𝐴���𝐴���𝐴���𝐴��� and 𝐴���𝐴���𝐴���𝐴���𝐴��� obtained through the
previous equations are used next in order to obtain the bids that can be
offered in the regulation capacity market. Considering all the above, a
new group of equations must be written:
∑
(𝑖���,𝑖���)
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ 𝐴���𝐴���𝑖��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���
(41)
∑
(𝑖���,𝑖���)
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ 𝐴���𝐴���𝑖��� ∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���
(42)
𝐴���𝐴���𝑖��� ≤
∑
(𝑖���,𝑖���)
𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(43)
𝐴���𝐴���𝑖��� ≤
∑
(𝑖���,𝑖���)
𝐴���𝐴��� 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���
(44)
Eqs. (41)–(42), state that the effective energy charging and discharg-
ing from regulation must be less than the amount offered in the market.
Finally, (43)–(44) state that the total energy offered in the regulation
market must be less than or equal to the total available regulation
capacity.
Fig. 1. Garver six-bus system.
Finally, note that a constraint is needed imposing that the amounts
of energy accepted in the effective regulation market must always be
within the limits previously computed.
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ 𝐴���𝐴���𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(45)
𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� ≤ 𝐴���𝐴��� 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
∀𝑎���𝑎���, ∀𝑎���𝑖���, ∀𝑖���, ∀𝑖���, ∀𝑖���
(46)
2.9. Power-system security equations
The power flow equations, power-system balance and line technical
limits are considered in (47)–(50):
𝐴��� 𝐴���𝐴���
𝑖���,𝑖���
=
∑
𝑖���
∑
(𝑎���𝑎���,𝑎���𝑖���)
𝜒���𝑎���𝑎��� ⋅ 𝜒���𝑎���𝑖��� ⋅ (𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − 𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖���
(47)
+ 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� − 𝐴���𝐴���𝐴���𝑎���𝑎���,𝑎���𝑖���
𝑖���,𝑖���,𝑖��� )
∀𝑖���, ∀𝑖���
𝐴��� 𝐴���
𝑖��� +
∑
𝐴���
𝐴��� 𝐴���
𝑖���,𝑖��� −
∑
𝐴���
𝐴��� 𝐴���
𝑖���,𝑖��� + 𝐴��� 𝐴���𝐴���
𝑖���,𝑖���
+
∑
𝑖���∝𝑖���
𝐴��� 𝑖���,𝑖���
𝑖���
= 0
∀𝑖���, ∀𝑖���
(48)
𝐴��� 𝑖���,𝑖���
𝑖���
= 𝐴���𝑖���,𝑖��� ⋅ (𝜁���𝑖���
𝑖��� − 𝜁���𝑖���
𝑖��� )
∀𝑖���, 𝑖��� ∝ 𝑖���
(49)
− 𝐴��� 𝑖���,𝑖���
𝑖���𝑎𝑖��� ≤ 𝐴��� 𝑖���,𝑖���
𝑖���
≤ 𝐴��� 𝑖���,𝑖���
𝑖���𝑎𝑖���
∀𝑖���, 𝑖��� ∝ 𝑖���
(50)
Eq. (47) gives the weighted EV power nodal contribution. Eq. (48)
assures the system power balance between load and generation. The
DC power flow equations are defined in (49). Finally, the line technical
limits are expressed in (50).
2.10. Optimization problem formulation
Finally, considering the objective function and all the constraints
presented, the full optimization problem is cast as a mixed-integer
stochastic programming problem that maximizes EV aggregator profit.
This problem comprises Eqs. (1)–(50).
3. Illustrative case study: Problem parameters and input data
In this section, the main input data of the case study are presented.
First, the electric power system characteristics are described and, then,
the parameters regarding the optimization problem are given.
The system considered in this study is based on the data given
in [33]. It is composed of six buses with a configuration of loads and
generators given in Fig. 1. The slack bus is assumed to be bus 6. Line
parameters and power flow limits are shown in Table 1, considering a
100 MVA base. All lines have 100 MW of active power limit. We assume
there are EVs in every bus; these EVs travel from a starting bus to which
they come back after travelling thorough some other nodes.
Energy 265 (2023) 126147
7
S. de la Torre et al.
Table 1
Line characteristics.
Line
𝐴���[𝑖���𝑖���] (Ω)
𝐴���[𝑖���𝑖���] (Ω)
1–2
0.10
0.40
1–4
0.15
0.60
1–5
0.05
0.20
2–3
0.05
0.20
2–4
0.10
0.40
2–6
0.08
0.30
3–5
0.05
0.20
4–6
0.08
0.30
Fig. 2. Aggregated system load and generation.
Fig. 3. Scenarios considered in this work.
The network represented in Fig. 1 is a power transmission (high-
voltage line) network. The rationale for using a power transmission
network is that, although most EV operations occur at the power distri-
bution network level, ancillary services are provided in the wholesale
electricity market by aggregators. Thus, since the focus of this work is
on studying the potential contribution of EVs to the provision of ancil-
lary services in the wholesale electricity market, a power transmission
network is needed to illustrate the potential contribution of EVs to the
power flexibility needed by the entire power system. Accordingly, the
power transmission network in Fig. 1 aggregates a large amount of EVs
in each bus (or node) of the network.
The hourly aggregated loads and power supplied by generators are
shown in Fig. 2. The remaining power generation is supplied either by
the slack bus or by V2G operations from the EVs.
As mentioned before, an approach based on scenarios is taken into
consideration to model the uncertainty associated to EV driving pat-
terns and market prices. Specifically, three scenarios for energy prices
(EP1–EP2–EP3), four for energy/capacity regulation prices (RP1–RP2–
RP3–RP4) and six for EV groups are considered (EG1...EG6). These
scenarios are combined to give a total number of 3⋅4⋅6 = 72 scenarios
(see Fig. 3). For simplicity, we assume the scenarios are equiprobable.
Hourly price curves for EV charging and discharging have been as-
sumed for the purpose of this work; we assume a real-data hourly price
for our base scenario and the remaining scenarios are obtained through
a process of scaling up and down ±20%; thus, scenarios (EP1–EP2–
EP3) are obtained. Prices for regulation have been similarly assumed,
Fig. 4. Hourly prices.
Table 2
EV group scenarios.
EVs 1
EVs 2
EVs 3
Pattern 1
Pattern 2
𝑖���1
200
300
500
𝑖���1 → 𝑖���2 → 𝑖���1
𝑖���1 → 𝑖���2 → 𝑖���3 → 𝑖���1
(𝑖���7, 𝑖���19)
(𝑖���7, 𝑖���14, 𝑖���20)
𝑖���2
300
400
600
𝑖���2 → 𝑖���3 → 𝑖���2
𝑖���2 → 𝑖���3 → 𝑖���4 → 𝑖���2
(𝑖���8, 𝑖���20)
(𝑖���8, 𝑖���15, 𝑖���18)
𝑖���3
400
500
700
𝑖���3 → 𝑖���4 → 𝑖���3
𝑖���3 → 𝑖���4 → 𝑖���3
(𝑖���6, 𝑖���13)
(𝑖���10, 𝑖���19)
𝑖���4
500
600
800
𝑖���4 → 𝑖���5 → 𝑖���4
𝑖���4 → 𝑖���5 → 𝑖���6 → 𝑖���4
(𝑖���9, 𝑖���21)
(𝑖���7, 𝑖���13, 𝑖���19)
𝑖���5
600
700
900
𝑖���5 → 𝑖���6 → 𝑖���5
𝑖���5 → 𝑖���6 → 𝑖���1 → 𝑖���5
(𝑖���8, 𝑖���19)
(𝑖���9, 𝑖���12, 𝑖���20)
with capacity prices for upward and downward regulation being equal,
but effective energy prices for regulation up and down different. We
generate four different scenarios for regulation prices; for each of these
scenarios we set the hourly prices for regulation capacity, effective
regulation up and effective regulation down, this process generates
scenarios (RP1–RP2–RP3–RP4). Fig. 4 shows all the hourly prices for
one specific scenario.
The EVs considered in this work are all identical, with a battery
capacity equal to 20 kWh, and for every EV the minimum SOC is fixed
at 20% of the battery capacity; also, note that the maximum charging
and discharging power considered is 3.7 kW. To model different EV
behaviours, five EV groups are considered. For the reference scenario,
each group has 200, 300, 400, 500 and 600 EVs, respectively. To
generate two additional scenarios, these numbers are increased by an
amount of 100 and 300 EVs in each group, respectively; see columns
EVs 1, EVs 2 and EVs 3 in Table 2. For each EV group, two different
driving patterns are considered, as seen also in Table 2; the nodes and
time periods given in the table describe the journey performed; e.g.:
the first EV group performs 2 trips under the 𝐴��� 𝑎𝑖���𝑖���𝑎���𝑖���𝑖��� 1 condition: the
first trip at 7 a.m. brings the EVs from 𝑖���𝑖���𝑎���𝑎���1 to 𝑖���𝑖���𝑎���𝑎���2; the return trip
a 7 p.m. brings the EVs back from 𝑖���𝑖���𝑎���𝑎���2 to 𝑖���𝑖���𝑎���𝑎���1. In all, 6 different
scenarios are considered to model each group, as each group can have
3 possible values for the number of vehicles and 2 possible itineraries
during the day. Note also that, in the proposed data, all vehicles end
their day in the same node as they began, reflecting the fact that many
EVs belong to private owners or companies that park the vehicles for
the night in a specific location; furthermore, note that nodes 4 and 5
are home to many more EVs than nodes 1 and 6, indicating that the
former are residential areas and the latter are probably industrial or
commercial areas.
Regarding the 𝐴���𝐴���𝐴��� requirements, it is assumed that the 𝐴���𝐴���𝐴��� has
to reach a minimum of 25% of the battery capacity before the first
journey of the day and also that the 𝐴���𝐴���𝐴��� has to be equal to or greater
than the initial 𝐴���𝐴���𝐴��� at the end of the day. The parameter 𝐴���𝑎���𝑎���
𝑖���,𝑖���,𝑖��� can
be determined according to the data presented so far and taking into
account the transition nodes shown in Table 2. To calculate the battery
consumption, a 30 km average trip and 0.20 kWh/km are assumed.
Charging and discharging efficiencies are 0.90 and 0.95, respectively.
Energy 265 (2023) 126147
8
S. de la Torre et al.
Table 3
Characteristics of the study cases.
Experiment
EV charging
EV discharging
Regulation
Other
1
✓
✗
✗
✗
2
✓
✓
✗
✗
3
✓
✓
Only ↓
✗
4
✓
✓
↓ and ↑
✗
5
✓
✓
↓ and ↑
Congestion
6
✓
✓
↓ and ↑
Number of EVs x3
4. Case study: Results and discussion
In this section, the results obtained from solving the optimization
problem described in previous sections are presented. The main vari-
ables included in this analysis are the following: the hourly values of the
𝐴���𝐴���𝐴���𝑖��� and capacity limits, the amount of power dedicated to regulation
up and down, power flow in system lines and the profit obtained by the
EV aggregator.
The study is centred on six experiments, see Table 3. The first
and second experiments do not include the regulation service, 𝐴���𝑖���𝑖���1
considers only EV charging and 𝐴���𝑖���𝑖���2 considers both EV charging
and discharging (V2G). These first two cases are specially interest-
ing as basic benchmarks for the remaining experiments studied. The
next two experiments include charging, discharging and regulation.
In 𝐴���𝑖���𝑖���3, only downwards regulation is featured, while full regulation
capabilities are included in 𝐴���𝑖���𝑖���4. No line congestion appears in any
of these two experiments. 𝐴���𝑖���𝑖���5 is similar to 𝐴���𝑖���𝑖���4, but considering
line congestion, which is forced in line 3–5 by means of a reduction
in its technical thermal limit. Finally, 𝐴���𝑖���𝑖���6 describes a particular
additional scenario in which a three-fold increase in the number of EVs
is assumed. Table 3 summarizes the characteristics of the experiments
described above. Henceforth, results regarding 𝐴���𝑖���𝑖���4, are considered as
a reference, and the results from all other experiments are presented as
compared against it.
In order to model battery degradation and loss of capacity, we have
used data provided by manufacturers that takes into account both the
DoD and the number of cycles. In this context, the degradation costs
in the battery are significant, compared to the revenue obtained by the
aggregator.
Figs. 5 and 6 show the hourly SOC values for EV group 2 and
the power assigned for charging, discharging and regulation; for the
remaining groups the configuration is quite similar considering that
driving patterns are not very different among the scenarios and only
the number of EVs is modified. 𝐴���𝐴���𝐴���𝐴���𝐴��� and 𝐴���𝐴���𝐴���𝐴���𝐴��� represent those
SOCs that bound upward and downward regulation capacity, while
𝐴���𝐴���𝐴���𝐴���𝐴��� is the SOC that includes energy from regulation and 𝐴���𝐴���𝐴���
only considers EV charging and discharging. It can be noticed that,
due to regulation prices, both the capacity and effective energy for
upward regulation are placed in the intermediate time periods between
15 h and 18 h. In the same way, downward regulation is scheduled
at the beginning and at the end of the day also because of the
constraints related to both the 𝐴���𝐴���𝐴��� before the first journey and the
final energy requirements. In Fig. 7, which gives the hourly allocation
for regulation, the aspects mentioned above can also be clearly noticed.
It is important to bear in mind that the 𝐴���𝐴���𝐴��� curve gives the hourly
values of the energy contained in EV batteries when the aggregator
is only offering capacity and 𝐴���𝐴���𝐴���𝐴���𝐴��� is the optimal track of the SOC
when energy payments coming from regulation up and down are also
considered. In this sense, the vertical amount for each time period
from the 𝐴���𝐴���𝐴��� curve to 𝐴���𝐴���𝐴���𝐴���𝐴��� and 𝐴���𝐴���𝐴���𝐴���𝐴��� curves gives the power
available for regulation and any SOC between these values is feasible,
with the computed optimal defined by 𝐴���𝐴���𝐴���𝐴���𝐴���.
In Fig. 8, the highest hourly system line power flows are given. It
can be appreciated that, for the initial test parameters, there is no line
congestion, but lines 2–3 and 3–5 are heavily loaded.
Fig. 5. Experiment 4 — SOC for EV group 2.
Fig. 6. Experiment 4 — Regulation Power for EV group 2.
Fig. 7. Experiment 4 — Hourly regulation capacity.
The benefit obtained by the aggregator can be calculated dividing
the value of the objective function by the average number of EVs. If
the capacity of power transmission lines is decreased, the benefit of
the aggregator is decreased because it must adapt its strategy to avoid
line congestion. However, the room for manoeuvre is narrow due to
the 𝐴���𝐴���𝐴��� constraints, the available capacity based on the number of
EVs and the fixed system loads that lead to overloaded lines with small
line technical limit reductions.
As previously mentioned, the results presented here correspond to
Experiment 4, our reference case, with both types of regulation and
with no line congestion. In Experiment 5, congestion in line 3–5 is
forced through the reduction in its technical limit. The technical limit
was chosen subtracting small quantities from the hourly maximum
power flow values in the reference experiment until further reductions
lead to infeasible results. Finally, for experiment 6, the number of EVs
were made three times larger than the initial number.
Table 4 shows the total daily aggregator income and costs in e
and the average income/costs values, based on the number of the EVs
for the different simulated experiments. In this Table, CH is the cost
associated with buying energy to charge; DH is the income associated
Energy 265 (2023) 126147
9
S. de la Torre et al.
Table 4
Daily aggregator income and costs, for all experiments performed.
Income/Cost
1
2
3
4
5
6
CH (e)
739.24
1822.99
1775.95
3061.68
3269.22
9185.05
DH (e)
0.00
1425.05
1363.95
1253.79
1436.07
3761.42
RUP (e)
0.00
0.00
0.00
438.58
438.58
1315.75
RDN (e)
0.00
0.00
551.75
132.19
132.19
396.57
ERUP (e)
0.00
0.00
0.00
2613.68
2613.68
7841.05
ERDN (e)
0.00
0.00
1337.03
261.53
261.53
784.59
Total profit (e)
−739.24
−397.94
1476.78
1638.09
1612.83
4914.33
EV profit (e/EV)
−0.2772
−0.1492
0.5538
0.6143
0.6048
0.6143
Fig. 8. Line power flows.
with selling energy to the network (V2G operations); RUP and RDN are
the incomes associated with up and down regulation capacity; finally,
ERUP and ERDN are incomes associated with effective up and down
regulation, respectively.
It can be noticed from Table 4 that, when only charging and
discharging are allowed, the difference between income and costs is
negative; that is, the aggregator has to pay for the energy stored in
EV batteries to fulfil the driving requirements. The battery discharging
leads to a decrease in costs, but it is not enough to obtain a positive
profit. However, when regulation is considered, this difference becomes
positive; that is, the income exceeds the operation costs, and some
profit can be obtained. Note that the highest profit is obtained in 𝐴���𝑖���𝑖���4,
when both types of regulation are allowed and no line congestion takes
place. Also note that when congestion appears, profits are reduced. For
𝐴���𝑖���𝑖���6, the number of EVs is increased, and the total aggregator benefit
is also increased; however, the profit per EV is not modified due to the
linear nature of the problem.
The results presented in Table 4 show that, in this case, the aggrega-
tor has to carefully watch those EVs that charge/discharge in nodes 2,
3 and 5 because they can have an important effect on the closest lines
that are heavily loaded. This effect depends on the assumed parameters
of the problem and the system characteristics and particularly on the
distribution factors.
Battery degradation estimation
In addition, an ex-post estimation of the global degradation battery
costs is presented. Taking the information from [27,34,35], and based
on the final SOCs curve, the battery degradation costs in e
per day
is given in Table 5 for Experiments 3, 4 and 5 previously presented;
e.g. in the case of Experiment 3, the battery may perform its daily
duties with an average of 1.5 cycles per day and a maximum depth of
discharge of 30%; this will add a cost of approximately 0.9 e per day
to the cost previously obtained. These figures are based on a battery
investment of 200 e/kWh and assuming that the battery has to be
replaced when the capacity loss reaches 70% for the corresponding DoD
and cycle regime. From Table 5, it is clear that aspects regarding battery
costs and performance must be improved; that is, battery investment
Table 5
Estimated battery degradation costs.
Experiment
DoD (%)
cycles/day
Costs (e/EV day)
3
30
1.5
0.9112
4
80
1
1.6162
5
50
2
2.0253
has to be reduced and battery technology advancement must decrease
battery degradation to make the regulation service profitable. Recent
developments in battery technology point clearly in that direction,
hence we conclude that these applications will be profitable very soon.
Finally, additional simulation experiments have been performed
considering, first, a reduction in regulation prices and, second, splitting
the main problem into two sequential stages. Results show that energy
payments from regulation for the first case can be decreased more
than 60% with respect to the reference experiment maintaining a
positive aggregator profit, but without considering battery degradation.
Therefore, it is proved that capacity payments are very important for
the aggregator operation. In the second case, if the complete problem
is divided into two problems, the first stage that considers only energy
charging/discharging from daily market prevents the aggregator to ob-
tain additional regulation income due to the lack of flexibility derived
from the SOC that is fixed and taken as data for the second stage. Due to
this, it is verified that joint optimization of both energy and regulation
leads to optimal aggregator benefit compared to the approach based
on the consideration of two independent stages. In addition, it is worth
mentioning that the aggregator in our model acts as the link between
the main grid and EV private owners, collaborating with the system
operator, but not governed by it. In this sense, different results may be
achieved considering EV fleet management or changing the interaction
among the different stakeholders.
5. Conclusions
An optimization approach for daily energy and regulation manage-
ment for EV aggregators has been proposed. The optimization problem
is formulated as a mixed-integer linear programming problem aimed
at maximizing EV aggregator profit, while jointly considering the most
important aspects influencing EVs profitability, such as uncertainty
in prices and drivers’ patterns, capacity constraints, state of charge
constraints, regulation demand constraints, regulation offer constraints,
regulation bounds constraints, and power-system security constraints.
The results have demonstrated that EVs have potential to provide
significant economic benefits to EV aggregators. In particular, in the
case studies presented here, EV aggregator’s profit becomes positive
when up and down regulation is considered. Additionally, we showed
that line congestion may significantly impact on aggregators’ benefit
and their EV operations. Accordingly, an interesting extension of this
work in the future is the analysis of the relationship between the long-
term investment decisions in the transmission system (i.e., transmission
expansion planning) and the EV aggregators’ operation decisions, ex-
ploring potential co-benefits for EV aggregators of relieving congestion
in the power network.
Energy 265 (2023) 126147
10
S. de la Torre et al.
It has been also shown that capacity payments play an impor-
tant role for the EV aggregator operation to be economically feasible,
even potentially more important than those payments from frequency
regulation.
From the modelling viewpoint, the energy and regulation co-
optimization problem turns out to be the optimal approach compared
to the classical two stage approach that breaks down the aggregator
problem into daily energy and regulation problems.
Finally, it is worth mentioning that, if battery degradation is taken
into account, regulation may not be profitable under the assumptions
made in this work and some kind of compensation might be needed
through, for instance, EV subsidies or higher prices for both energy
and capacity for regulation in order to ensure EV aggregators’ positive
profit.
CRediT authorship contribution statement
S. de la Torre: Conceptualization, Methodology, Software, Investi-
gation, Writing – original draft, Writing – review & editing, Funding ac-
quisition. J.A. Aguado: Conceptualization, Methodology, Investigation,
Validation, Writing – review & editing, Project administration, Fund-
ing acquisition. E. Sauma: Methodology, Validation, Investigation,
Visualization, Writing – review & editing, Funding acquisition.
Declaration of competing interest
The authors declare that they have no known competing finan-
cial interests or personal relationships that could have appeared to
influence the work reported in this paper.
Data availability
No data was used for the research described in the article.
Acknowledgements
This work has been partially funded by project ENE2016-80638-R,
granted by Ministerio de Economía 𝑖��� Competitividad of the Govern-
ment of Spain, by project UMA-FEDERJA-150 grant by the Junta de
Andalucía, Spain, by ANID through Millennium Institute on Green Am-
monia as Energy Vector (MIGA), ANID/Millennium Science Initiative,
Kenya
Program/ICN2021-023,
ANID/FONDECYT-Regular/1220439,
and ANID/FONDEF/ID21I10119 grant, and by Proyecto de Excelencia
P20-01164 by the Junta de Andalucía. Funding for open access charge:
Universidad de Málaga - CBUA.
References
[1] International Energy Agency. Global EV outlook 2021: Accelerating ambitions
despite the pandemic. Electric Vehicles Initiative. Paris: IEA; 2021, URL https:
//www.iea.org/reports/global-ev-outlook-202.
[2] Bessa RJ, Matos MA. Economic and technical management of an aggrega-
tion agent for electric vehicles: a literature survey. Eur Trans Electr Power
2012;22(3):334–50. http://dx.doi.org/10.1002/etep.565.
[3] Noel L, Carrone A, Jensen A, Zarazua de Rubens G, Kester J, Sovacool B.
Willingness to pay for electric vehicles and vehicle-to-grid applications: A Nordic
choice experiment. Energy Econ 2019;78:525–34. http://dx.doi.org/10.1016/j.
eneco.2018.12.014.
[4] Fang Y, Asche F, Novan K. The costs of charging Plug-in Electric Vehicles
(PEVs): Within day variation in emissions and electricity prices. Energy Econ
2018;69:196–203. http://dx.doi.org/10.1016/j.eneco.2017.11.011.
[5] Hu J, Morais H, Sousa T, Lind M. Electric vehicle fleet management in smart
grids: A review of services, optimization and control aspects. Renew Sustain
Energy Rev 2016;56:1207–26. http://dx.doi.org/10.1016/j.rser.2015.12.014.
[6] Cortes Borray AF, Merino J, Torres E, Mazon J. A review of the population-based
and individual-based approaches for electric vehicles in network energy studies.
Electr Power Syst Res 2020;189. http://dx.doi.org/10.1016/j.epsr.2020.106785.
[7] Runqi D, Xiang Y, H. D, L. Y, H. Y, Cheng H, L. J. Exploring flexibility of
electric vehicle aggregators as energy reserve. Electr Power Syst Res 2020;184.
http://dx.doi.org/10.1016/j.epsr.2020.106305.
[8] Benalcazar P, E. SM, Vargas A. Short-term economic dispatch of smart distribu-
tion grids considering the active role of plug-in electric vehicles. Electr Power
Syst Res 2019;177. http://dx.doi.org/10.1016/j.epsr.2019.105932.
[9] Zhang Q, Li Y, Li C, Li C. Grid frequency regulation strategy considering
individual driving demand of electric vehicle. Electr Power Syst Res 2018;163.
http://dx.doi.org/10.1016/j.epsr.2018.05.019.
[10] Rezaei N, Khazali A, Mazidi M, Ahmadi A. Economic energy and reserve
management of renewable-based microgrids in the presence of electric vehicle
aggregators: A robust optimization approach. Energy 2020;201. http://dx.doi.
org/10.1016/j.energy.2020.117629.
[11] Faddel S, Aldeek A, Al-Awami AT, Sortomme E, Al-Hamouz Z. Ancillary services
bidding for uncertain bidirectional V2G using fuzzy linear programming. Energy
2018;160:986–95. http://dx.doi.org/10.1016/j.energy.2018.07.091.
[12] Gao S, Li H, Jurasz J, Dai R. Optimal charging of electric vehicle aggregations
participating in energy and ancillary service markets. IEEE J Emerg Sel Top Ind
Electron 2022;3(2):270–8.
[13] Sinan Cai RM. Optimal dispatching control of EV aggregators for load frequency
control with high efficiency of EV utilization. Appl Energy 2022;319.
[14] Sortomme E, El-Sharkawi MA. Optimal charging strategies for unidirectional
vehicle-to-grid. IEEE Trans Smart Grid 2011;2(1):131–8. http://dx.doi.org/10.
1109/TSG.2010.2090910.
[15] Sortomme E, El-Sharkawi MA. Optimal combined bidding of vehicle-to-grid
ancillary services. IEEE Trans Smart Grid 2012;3(1):70–9. http://dx.doi.org/10.
1109/TSG.2011.2170099.
[16] Shuai W, Maille P, Pelov A. Incentivizing electric vehicles to provide regulation
while recharging. In: Smart grid technologies - Asia (ISGT ASIA), 2015 IEEE
innovative. 2015, p. 1–6. http://dx.doi.org/10.1109/ISGT-Asia.2015.7387134.
[17] Han S, Han S, Sezaki K. Development of an optimal vehicle-to-grid aggregator
for frequency regulation. IEEE Trans Smart Grid 2010;1(1):65–72. http://dx.doi.
org/10.1109/TSG.2010.2045163.
[18] Vayá MG, Andersson G. Combined smart-charging and frequency regulation for
fleets of plug-in electric vehicles. In: IEEE power and energy society general
meeting. 2013, http://dx.doi.org/10.1109/PESMG.2013.6672852.
[19] Bhattarai BP, Myers KS, Bak-Jensen B, de Cerio Mendaza ID, Turk RJ, Gentle JP.
Optimum aggregation of geographically distributed flexible resources in strategic
smart-grid/microgrid locations. Int J Electr Power Energy Syst 2017;92:193–201.
http://dx.doi.org/10.1016/j.ijepes.2017.05.005.
[20] Donadee J, Ilic MD. Stochastic optimization of grid to vehicle frequency
regulation capacity bids. IEEE Trans Smart Grid 2014;5(2):1061–9. http://dx.
doi.org/10.1109/TSG.2013.2290971.
[21] Ortega-Vázquez MA, Bouffard F, Silva V. Electric vehicle aggregator/system
operator coordination for charging scheduling and services procurement. IEEE
Trans Power Syst 2013;28(2):1806–15. http://dx.doi.org/10.1109/TPWRS.2012.
2221750.
[22] Bessa RJ, Matos MA. Optimization models for an EV aggregator selling secondary
reserve in the electricity market. Electr Power Syst Res 2014;106:36–50. http:
//dx.doi.org/10.1016/j.epsr.2013.08.006.
[23] Vagropoulos SI, Bakirtzis AG. Optimal bidding strategy for electric vehicle
aggregators in electricity markets. IEEE Trans Power Syst 2013;28(4):4031–41.
http://dx.doi.org/10.1109/TPWRS.2013.2274673.
[24] Sortomme E, El-Sharkawi MA. Optimal scheduling of vehicle-to-grid energy and
ancillary services. IEEE Trans Smart Grid 2012;3(1):351–9. http://dx.doi.org/10.
1109/TSG.2011.2164099.
[25] López MA, de la Torre S, Martín S, Aguado JA. Demand-side management in
smart grid operation considering electric vehicles load shifting and vehicle-to-
grid support. Int J Electr Power Energy Syst 2015;64:689–98. http://dx.doi.org/
10.1016/j.ijepes.2014.07.065.
[26] Han S, Soo HH, Sezaki K. Design of an optimal aggregator for vehicle-to-grid
regulation service. In: Innovative smart grid technologies conference, ISGT 2010.
2010, http://dx.doi.org/10.1109/ISGT.2010.5434773.
[27] Bishop JDK, Axon CJ, Bonilla D, Tran M, Banister D, McCulloch MD. Evaluating
the impact of V2G services on the degradation of batteries in PHEV and EV. Appl
Energy 2013;111:206–18. http://dx.doi.org/10.1016/j.apenergy.2013.04.094.
[28] Peterson SB, Whitacre JF, Apt J. The economics of using plug-in hybrid electric
vehicle battery packs for grid storage. J Power Sources 2010;195(8):2377–84.
http://dx.doi.org/10.1016/j.jpowsour.2009.09.070.
[29] Yu N, Foggo B. Stochastic valuation of energy storage in wholesale power
markets. Energy Econ 2017;64:177–85. http://dx.doi.org/10.1016/j.eneco.2017.
03.010.
Energy 265 (2023) 126147
11
S. de la Torre et al.
[30] Dietrich A, Weber C. What drives profitability of grid-connected residential
PV storage systems? A closer look with focus on Germany. Energy Econ
2018;74:399–416. http://dx.doi.org/10.1016/j.eneco.2018.06.014.
[31] Thomson AW. Economic implications of lithium ion battery degradation for
Vehicle-to-Grid (V2X) services. J Power Sources 2018;396:691–709. http://dx.
doi.org/10.1016/j.jpowsour.2018.06.053.
[32] Jargstorf J, Wickert M. Offer of secondary reserve with a pool of electric vehicles
on the German market. Energy Policy 2013;62:185–95. http://dx.doi.org/10.
1016/j.enpol.2013.06.088.
[33] Garver L. Transmission network estimation using linear programming. IEEE
Trans Power Appar Syst 1970;PAS-89(7):1688–97. http://dx.doi.org/10.1109/
TPAS.1970.292825.
[34] Andersson SL, Elofsson aK, Galus MD, Göransson L, Karlsson S, Johnsson F,
Andersson G. Plug-in hybrid electric vehicles as regulating power providers:
Case studies of Sweden and Germany. Energy Policy 2010;38(6):2751–62. http:
//dx.doi.org/10.1016/j.enpol.2010.01.006.
[35] Tomic J, Kempton W. Using fleets of electric-drive vehicles for grid support. J
Power Sources 2007;168(2):459–68. http://dx.doi.org/10.1016/j.jpowsour.2007.
03.010.
